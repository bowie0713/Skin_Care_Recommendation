---
title: "skincare"
author: "Christina Pham"
date: "2025-01-30"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(httr)
library(rvest)
library(jsonlite)
library(tidyverse)
library(reticulate)
```
https://www.sephora.com/shop/facial-toner-skin-toner/?pageSize=300&currentPage=1

```{python}
import requests
from bs4 import BeautifulSoup
import pandas as pd

# Step 1: Extract all product URLs from the sitemap
sitemap_url = "https://www.sephora.com/sitemaps/products-sitemap_en-CA.xml"

```

```{python}
from selenium import webdriver
import time

# Initialize Selenium WebDriver
options = webdriver.ChromeOptions()
options.add_argument("--disable-gpu")
driver = webdriver.Chrome(options = options)  # Ensure you have ChromeDriver installed
driver.get(sitemap_url)

time.sleep(5)

# Get the page source after fully loading
sitemap_html = driver.page_source

driver.quit()
```

```{r}
#save sitemap
sitemap_html <- py$sitemap_html
writeLines(py$sitemap_html, "sitemap.html")
```

```{python}
sitemap_html
# TO DO: 
#Check for unavailable prods 
# <h1 class="css-tz2kl4 e15t7owz0" data-comp="BaseComponent ">Sorry, this product is not available.</h1>

```

```{python}

sitemap_html
soup = BeautifulSoup(sitemap_html, 'html.parser')
soup
rows = soup.select('loc')
rows
rows = pd.DataFrame(rows)
```

```{r}
rows_html <- py$rows
rows_html %>% 
  filter(
    str_detect(X0, "shampoo") | str_detect(X0, "conditioner") | str_detect(X0, "cleanser") | str_detect(X0, "cleanse") | str_detect(X0, "cleansing") | str_detect(X0, "cream") | str_detect(X0, "creme") | str_detect(X0, "moisturizer") | str_detect(X0, "toner") | str_detect(X0, "serum") | str_detect(X0, "mask")
  )

```

```{r}
library(rvest)

url <- "https://www.sephora.com/shop/facial-treatments"

# Read the HTML content from the URL
webpage <- read_html(url)
#Crawl-delay: 5

# Extract product names and brand names
# Replace '.css-2uq0c7' and '.css-1k1z2gz' with the correct CSS selectors based on the website's HTML
product_names <- webpage %>% html_nodes(".css-2uq0c7") %>% html_text(trim = TRUE)
brand_names <- webpage %>% html_nodes(".css-1k1z2gz") %>% html_text(trim = TRUE)

# Combine the product names and brand names into a data frame
products <- data.frame(Brand = brand_names, Product = product_names)

# Print the result
print(products)

```


